/**
 * Created by filip on 4.5.15..
 */

!function(a,b,c){"use strict";b.module("ui.sortable",[]).value("uiSortableConfig",{}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(a,d,e){return{require:"?ngModel",scope:{ngModel:"=ngModel",uiSortable:"=uiSortable"},link:function(f,g,h,i){function j(a,b){return b&&"function"==typeof b?function(c,d){a(c,d),b(c,d)}:a}function k(a){var b=a.data("ui-sortable");return b&&"object"==typeof b&&"ui-sortable"===b.widgetFullName?b:null}function l(a,b){var c=a.sortable("option","helper");return"clone"===c||"function"==typeof c&&b.item.sortable.isCustomHelperUsed()}function m(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))}function n(a,b){b.item.sortable._destroy()}var o,p={},q={"ui-floating":c},r={receive:null,remove:null,start:null,stop:null,update:null},s={helper:null};return b.extend(p,q,a,f.uiSortable),b.element.fn&&b.element.fn.jquery?(i?(f.$watch("ngModel.length",function(){d(function(){k(g)&&g.sortable("refresh")},0,!1)}),r.start=function(a,d){if("auto"===p["ui-floating"]){var e=d.item.siblings(),f=k(b.element(a.target));f.floating=m(e)}d.item.sortable={model:i.$modelValue[d.item.index()],index:d.item.index(),source:d.item.parent(),sourceModel:i.$modelValue,cancel:function(){d.item.sortable._isCanceled=!0},isCanceled:function(){return d.item.sortable._isCanceled},isCustomHelperUsed:function(){return!!d.item.sortable._isCustomHelperUsed},_isCanceled:!1,_isCustomHelperUsed:d.item.sortable._isCustomHelperUsed,_destroy:function(){b.forEach(d.item.sortable,function(a,b){d.item.sortable[b]=c})}}},r.activate=function(){o=g.contents();var a=g.sortable("option","placeholder");if(a&&a.element&&"function"==typeof a.element){var c=a.element();c=b.element(c);var d=g.find('[class="'+c.attr("class")+'"]');o=o.not(d)}},r.update=function(a,b){if(!b.item.sortable.received){b.item.sortable.dropindex=b.item.index();var c=b.item.parent();b.item.sortable.droptarget=c;var d=c.attr("ng-model")||c.attr("data-ng-model");b.item.sortable.droptargetModel=c.scope().$eval(d),g.sortable("cancel")}l(g,b)&&!b.item.sortable.received&&"parent"===g.sortable("option","appendTo")&&(o=o.not(o.last())),o.appendTo(g),b.item.sortable.received&&(o=null),b.item.sortable.received&&!b.item.sortable.isCanceled()&&f.$apply(function(){i.$modelValue.splice(b.item.sortable.dropindex,0,b.item.sortable.moved)})},r.stop=function(a,b){!b.item.sortable.received&&"dropindex"in b.item.sortable&&!b.item.sortable.isCanceled()?f.$apply(function(){i.$modelValue.splice(b.item.sortable.dropindex,0,i.$modelValue.splice(b.item.sortable.index,1)[0])}):"dropindex"in b.item.sortable&&!b.item.sortable.isCanceled()||l(g,b)||o.appendTo(g),o=null},r.receive=function(a,b){b.item.sortable.received=!0},r.remove=function(a,b){"dropindex"in b.item.sortable||(g.sortable("cancel"),b.item.sortable.cancel()),b.item.sortable.isCanceled()||f.$apply(function(){b.item.sortable.moved=i.$modelValue.splice(b.item.sortable.index,1)[0]})},s.helper=function(a){return a&&"function"==typeof a?function(b,c){var d=a(b,c);return c.sortable._isCustomHelperUsed=c!==d,d}:a},f.$watch("uiSortable",function(a){var c=k(g);c&&b.forEach(a,function(a,b){return b in q?("ui-floating"!==b||a!==!1&&a!==!0||(c.floating=a),void(p[b]=a)):(r[b]?("stop"===b&&(a=j(a,function(){f.$apply()}),a=j(a,n)),a=j(r[b],a)):s[b]&&(a=s[b](a)),p[b]=a,void g.sortable("option",b,a))})},!0),b.forEach(r,function(a,b){p[b]=j(a,p[b]),"stop"===b&&(p[b]=j(p[b],n))})):e.info("ui.sortable: ngModel not provided!",g),void g.sortable(p)):void e.error("ui.sortable: jQuery should be included before AngularJS!")}}}])}(window,window.angular);